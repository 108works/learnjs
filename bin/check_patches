#!/usr/bin/env bash

abspath="$(cd "${0%/*}" 2>/dev/null; echo "$PWD"/"${0##*/}")"
bin_dir=`dirname $abspath`
root_dir=`dirname $bin_dir`

cd $root_dir

if [[ ! -d master ]]; then
  mkdir master
  cd master
  git init
else
  cd master
fi

git pull .. master

if ! cat $(ls ../patches/* | sort) | git apply --check --verbose --whitespace=error; then
  exit 1
fi

echo "All patches can be applied successfuly"

